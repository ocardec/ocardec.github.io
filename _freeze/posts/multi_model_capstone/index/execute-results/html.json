{
  "hash": "80b7333d57761b99a555ff931f393ed0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Aicraft's Lateral Deviation - Part 1\"\ndescription: \"Assessment of different classification algorithms and their respective results\"\nauthor: \"Oscar Cardec\"\ndate: \"11/12/2021\"\ncategories: [EDA, ETL, data, distribution, sample]\nimage: images/acft.jpg\npage-layout: full\nfreeze: true\ncode-block-bg: true\ncode-block-border-left: \"#31BAE9\"\nbibliography: references.bib\neditor_options: \n  chunk_output_type: inline\n---\n\n\n\n### Introduction\n\nOn any given day, thousands of flights are maneuvering throughout the U.S. national airspace. All of these are constantly monitored by one entity, the Federal Aviation Administration (FAA). The FAA's primary mission involves ensuring that flight operations are conducted efficiently, and to the highest levels of safety and security. In support of such endeavor, the continuous monitoring and accurate prediction of an aircraft position is a vital process across aeronautics and the FAA's mission. Accurate forecasting of a flight could have a significant impact on businesses’ schedules, transportation logistics, or even protecting the environment. In today’s era of big data and technology advances monitoring of en-route flights its an imperative.\n\n> **Disclaimer: The views and opinions expressed in this report are those of the author and do not necessarily reflect the views or positions of any of the entities herein referred.**\n\nThe following assessment builds out of a previously conducted analysis [@paglione2010] which documented a comprehensive evaluation of numerous aircraft's lateral deviations. For context, lateral deviations enclose divergent measurements of an aircraft’s actual position in comparison to its authorized flight route. Here I assess and identify alternate options to sustain aerial operations management using modern machine learning algorithms to expose aircraft lateral anomaly detection. It employs innovative statistical analyses, compare results with the previous findings, and introduces a more sophisticated approach to improve the tracking of civil and military aviation on near real-time basis.\n\n![](images/lateral_deviation_img.png){fig-align=\"center\" width=\"500\"}\n\n### Data\n\nTo accomplish the aforementioned, historical data of numerous flights is utilized. This data involves different continuous and categorical observations including the aircraft’s altitude, measurement times, calculated distances from targeted route, lateral and vertical statuses and suggested corrective heading among other.\n\nThe original data encompasses 20 control centers within the Continental United States averaging around 500,000 observations per center. That aggregates to over 10,000,000 measurements nation-wide in less than a 24-hour window. Analysis of such figures result costly when it comes to computational power and time. For such reason, I take a sampled-data approach, assuming that the data is representative of the entire population and statistically speaking inferences may be applied to the entire population. The following diagram provides a basic depiction of involved variables.\n\n![](images/variables.png){fig-align=\"center\" width=\"600\"}\n\n### Exploratory Data Analysis\n\nAs mentioned, the sampled data contains approximately 1.9 million flight observations from 4 specific Air Route Traffic Control Centers (ARTCC), namely, Chicago (ZAU), New York (ZNY), Miami (ZMA), and Los Angeles (ZLA). These observations contain attributes of an aircraft while cruising from one fix point or ARTCC to another, and the recorded data in increments of 10 seconds.\n\n![](images/artcc.png){fig-align=\"center\" width=\"500\"}\n\n<br/>\n\n\n\n\n\n\n\n**Note**: During exploratory steps the data is ingested and analyzed from a descriptive statistics standpoint. The 14 variables (different format types) are confirmed along with the total of 1.9 million observations. Also, notice how the \"buildTime\" variable is given as cumulative seconds, and the \"latAdherStatus\" as a character type. Notice, the \"latAdherStatus\" (lateral adherence status) variable which describes how distant the aircraft is from its authorized route (threshold recorded in nautical miles). This multivariate attribute is used as the target or dependable variable.\n\n![](images/thresholds.png){fig-align=\"center\" width=\"550\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(rawdf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t1988068 obs. of  14 variables:\n $ acid          : chr  \"AAL1016\" \"AAL1016\" \"AAL1016\" \"AAL1016\" ...\n $ cid           : chr  \"141\" \"141\" \"141\" \"141\" ...\n $ buildTime     : num  61560 61570 61580 61590 61600 ...\n $ TE            : chr  \"HMLP2\" \"HMLP2\" \"HMLP2\" \"HMLP2\" ...\n $ curAlt        : num  14766 15550 16233 16750 17000 ...\n $ stCenterTm    : num  61560 61560 61560 61560 61560 ...\n $ endCenterTm   : num  62180 62180 62180 62180 62180 ...\n $ mergeTime     : chr  \"null\" \"null\" \"null\" \"null\" ...\n $ vertCnfStatus : chr  \"inCnfDefault\" \"inCnfAscent\" \"inCnfAscent\" \"inCnfAscent\" ...\n $ vertCnfDist   : num  -26234 -25450 -24767 -24250 -24000 ...\n $ redLat        : num  -1.42 -1.72 -1.91 -1.96 -2.08 ...\n $ angle2NextFix : chr  \"10.71785671\" \"8.889666928\" \"8.00452716\" \"6.044758616\" ...\n $ latAdherStatus: chr  \"midNonConf\" \"outerNonConf\" \"outerNonConf\" \"outerNonConf\" ...\n $ artcc         : chr  \"ZAU\" \"ZAU\" \"ZAU\" \"ZAU\" ...\n```\n\n\n:::\n:::\n\n\n\n**Note**: After gaining a basic understanding of the data set structure, I selected a particular set of variables, renamed them for easier understanding, factorized the labels from categorical values to a numerical for best calculation purposes, and defined a transformation function to convert time values from numeric to HMS format.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# data selection\nmdata <- rawdf %>% \n  as_tibble() %>% \n  dplyr::select(acid,cid,buildTime,stCenterTm,endCenterTm,redLat,angle2NextFix,\n                latAdherStatus, artcc)\n\n# factorization of lateral adherance status\nlevels <-  c(\"innerInConf\", \"midInConf\", \"midNonConf\", \"outerNonConf\", \"endOfRoute\")\nlabels <-  c(\"1\", \"2\", \"3\", \"4\", \"5\")\nmdata$latAdherStatus <- factor(mdata$latAdherStatus, levels = levels, labels = labels)\n\n# variables renaming\nmaindf <- dplyr::rename(.data = mdata,\n                        AircraftID = acid,\n                        ComputerID = cid,\n                        MeasureTaken = buildTime,\n                        ControlStartTm = stCenterTm,\n                        ControlEndTm = endCenterTm,\n                        LateralDeviation = redLat,\n                        CorrectionAngle = angle2NextFix,\n                        LateralStatus = latAdherStatus,\n                        ARTCC = artcc\n                        )\n\n# time conversion \npacman::p_load(lubridate, hms)\ntimeconvert <- function(x){\n  # Transform time period from string to hms format ## \n  mt <- seconds_to_period(x)\n  mtstring <- sprintf('%02d:%02d:%02d', mt@hour, minute(mt), second(mt))\n  hms::as_hms(mtstring)}\n\n# trans with dplyr::mutate\ndf <- maindf %>% \n   dplyr::mutate(ARTCC = as.factor(ARTCC), \n    UniqueID = paste(AircraftID, ComputerID, sep = \"_\"), \n    Airline = substring(AircraftID, 1, 3),\n    Airline = as.factor(Airline),\n    MeasureTaken = as.numeric(MeasureTaken),\n    CorrectionAngle = as.character(CorrectionAngle),\n    LateralDeviation = as.double(LateralDeviation),\n    xMeasureTaken = timeconvert(MeasureTaken),\n    xControlStartTm = timeconvert(ControlStartTm),\n    xControlEndTm = timeconvert(ControlEndTm))\n\ndf$CorrectionAngle <- as.double(df$CorrectionAngle)\n\n# exclusion of NAs introduced by coercion \ndf$CorrectionAngle[is.na(df$CorrectionAngle)] <- max(df$CorrectionAngle, na.rm = TRUE) + 1\nhead(df, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 14\n   AircraftID ComputerID MeasureTaken ControlStartTm ControlEndTm\n   <chr>      <chr>             <dbl>          <dbl>        <dbl>\n 1 AAL1016    141               61560          61560        62180\n 2 AAL1016    141               61570          61560        62180\n 3 AAL1016    141               61580          61560        62180\n 4 AAL1016    141               61590          61560        62180\n 5 AAL1016    141               61600          61560        62180\n 6 AAL1016    141               61610          61560        62180\n 7 AAL1016    141               61620          61560        62180\n 8 AAL1016    141               61630          61560        62180\n 9 AAL1016    141               61640          61560        62180\n10 AAL1016    141               61650          61560        62180\n# ℹ 9 more variables: LateralDeviation <dbl>, CorrectionAngle <dbl>,\n#   LateralStatus <fct>, ARTCC <fct>, UniqueID <chr>, Airline <fct>,\n#   xMeasureTaken <time>, xControlStartTm <time>, xControlEndTm <time>\n```\n\n\n:::\n:::\n\n\n\n**Note**: Next, I portray the distributions of some variables. Considering the following graphics, I anticipate significant variance across the target variable. The original data appears to be consistent along the mean, of course with the exception of some outliers.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Lateral Adherence Status Labels\npar(mfrow = c(1, 1))\nplot(df$LateralDeviation, type = \"l\", ylab = \"Nautical Miles\",\n     col = \"darkblue\",  main = \"Lateral Deviations\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/latAdherence-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# lateral deviation boxplot\npar(mfrow=c(2,2), mar=c(3,3,3,3))\nboxplot(df$LateralDeviation, outline = TRUE, border = \"darkred\", \n        ylab = \"Nautical Miles\", main = \"Boxplot Lateral Deviations\")\nboxplot(df$LateralDeviation, outline = FALSE, col = \"lightgray\", border = \"darkred\",\n        ylab = NULL, main = \"Boxplot Lateral Deviations\\n(No Outliers)\")\n# histogram target variable\nhist((df$LateralDeviation), main=\"Histogram Lateral Deviations\",\n     xlab=\"Nautical Miles\", border=\"white\", col = \"darkblue\", labels = FALSE)\n# Lateral Deviations Log2 Calc Histogram\nhist((log2(df$LateralDeviation)), main=\"Histogram Lateral Deviations\\n(Log2)\",\n     xlab=\"Nautical Miles\", ylab = NULL, border=\"white\", col = \"darkblue\", labels = FALSE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/distributions-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n\n**Note**: The correction angle attribute refers to the degrees required to regain the proper heading in order to reach the next fix point associated with the flight plan. The following is a granular view of the correction angle data observations.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(2,1))\n# Before\nhist((sel1$CorrectionAngle), main=\"Correction Angle Histogram\",\n     xlab=\"Degrees\", border=\"white\", col = \"darkred\", labels = FALSE)\n# After Log\nhist(log2(sel1$CorrectionAngle), main=\"Correction Angle Histogram\\n(Log2)\",\n     xlab=\"Degrees\", border=\"white\", col = \"darkblue\", labels = FALSE)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/correctionAngle_distro-1.png){width=960}\n:::\n:::\n\n\n\n**Note**: Next I display each ARTCC and their respective aircraft behaviors in relation to their assigned route. Bottom line, the data distribution maintains uniformity when I separate the levels of deviations by their centers.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Lateral Deviation/Status per ARTCC\npacman::p_load(gridExtra)\npar(mfrow = c(1,1))\n\nls1 <- sel1 %>% \n  filter(LateralStatus == \"1\") %>% \n  ggplot()+\n  aes(LateralDeviation, \n      ARTCC)+\n  xlab(NULL)+\n  geom_jitter(col = \"grey\", size = .5, alpha = 0.2, show.legend = F)+\n  theme_light()\n\nls2 <- sel1 %>% \n  filter(LateralStatus == \"2\") %>% \n  ggplot()+\n  aes(LateralDeviation, \n      ARTCC) +\n  ylab(NULL)+xlab(NULL)+\n  geom_jitter(col = \"red\", size = .5, alpha = 0.2, show.legend = F)+\n  theme_light()\n\nls3 <- sel1 %>% \n  filter(LateralStatus == \"3\") %>% \n  ggplot()+\n  aes(LateralDeviation, \n      ARTCC)+xlab(NULL)+\n  geom_jitter(col = \"green\", size = .5, alpha = 0.2, show.legend = F)+\n  theme_light()\n\nls4 <- sel1 %>% \n  filter(LateralStatus == \"4\") %>% \n  ggplot()+\n  aes(LateralDeviation, \n      ARTCC)+\n  ylab(NULL)+xlab(NULL)+\n  geom_jitter(col = \"blue\", size = .5, alpha = 0.2, show.legend = F)+\n  theme_light()\n\nls5 <- sel1 %>% \n  filter(LateralStatus == \"5\") %>% \n  ggplot()+\n  aes(LateralDeviation, \n      ARTCC)+\n  geom_jitter(col = \"cyan\", size = .5, alpha = 0.2, show.legend = F)+\n  theme_light()\n\nls6 <- sel1 %>% \n  ggplot()+\n  aes(LateralDeviation, \n      ARTCC, col = sel1$LateralStatus)+\n  ylab(NULL)+\n  geom_jitter(col = sel1$LateralStatus, size = .5, alpha = 0.1, show.legend = T)+\n  theme_light()\n\ngrid.arrange(arrangeGrob(ls1, ls2, ls3, ls4, ls5, ls6), nrow=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/latDeviations-1.png){width=960}\n:::\n:::\n\n\n\n**Note**: One key insight, the above graph shows ZMA as the control center with the highest variability or dispersion. The trait makes sense considering that ZMA (Miami) sits in a significant different location more susceptible to different weather elements and offshore inbound and transient air traffic.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nssel3 <- sel1\n\n# function to calculate bounds\ncalc_iqr_bounds <- function(data) {\n  Q <- quantile(data, probs = c(0.25, 0.75), na.rm = TRUE)\n  iqr <- IQR(data, na.rm = TRUE)\n  lower <- Q[1] - 1.5 * iqr\n  upper <- Q[2] + 1.5 * iqr\n  return(list(lower = lower, upper = upper))\n}\n\n# calculation of bounds\nbounds <- calc_iqr_bounds(ssel3$LateralDeviation)\nNOutliers <- subset(ssel3$LateralDeviation, ssel3$LateralDeviation > bounds$lower & \n                    ssel3$LateralDeviation < bounds$upper)\n\n# distributions with and without outliers \npar(mfrow = c(1, 2))\nboxplot(ssel3$LateralDeviation, col = \"darkgrey\", border = \"darkred\", \n        horizontal = FALSE, main = \"Distribution with Outliers\")\n\nboxplot(NOutliers, col = \"darkgrey\", border = \"darkblue\", \n        main = \"Distribution without Outliers\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/IQR_calculation-1.png){width=672}\n:::\n:::\n\n\n\n**Note**: For best perception of these deviations, I went ahead and calculated additional measures applying moving average filters like weighted moving average with a backward window of two positions, the absolute values of the weighted moving average, and other backward windows to include the 4th prior period and the 7th period.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(forecast, pracma)\ndf1 <- ssel3\ndf1[\"WMA\"] <- pracma::movavg(df1$LateralDeviation, n = 2, type = \"w\")\ndf1[\"Abs_WMA\"] <- abs(df1$WMA)\ndf1[\"ma4_lateraldev\"] <- forecast::ma(df1$LateralDeviation, order=4)\ndf1[\"ma7_lateraldev\"] <- forecast::ma(df1$LateralDeviation, order=7)\nsummary(df1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n ARTCC           Airline          UniqueID          MeasureTaken  \n ZAU:549977   SWA    : 190572   Length:1988068     Min.   :61210  \n ZLA:547118   AAL    : 158419   Class :character   1st Qu.:68980  \n ZMA:473121   UAL    : 101846   Mode  :character   Median :74820  \n ZNY:417852   AWE    :  97578                      Mean   :74696  \n              DAL    :  85748                      3rd Qu.:80410  \n              COA    :  73412                      Max.   :86390  \n              (Other):1280493                                     \n xMeasureTaken     xControlStartTm   xControlEndTm     LateralDeviation   \n Length:1988068    Length:1988068    Length:1988068    Min.   :-748.9390  \n Class1:hms        Class1:hms        Class1:hms        1st Qu.:  -0.8658  \n Class2:difftime   Class2:difftime   Class2:difftime   Median :   0.0043  \n Mode  :numeric    Mode  :numeric    Mode  :numeric    Mean   :   0.3468  \n                                                       3rd Qu.:   0.8736  \n                                                       Max.   : 596.9131  \n                                                                          \n CorrectionAngle    LateralStatus      WMA               Abs_WMA        \n Min.   :  0.0000   1:802138      Min.   :-748.7875   Min.   :  0.0000  \n 1st Qu.:  0.8003   2:228148      1st Qu.:  -0.8656   1st Qu.:  0.2012  \n Median :  2.5434   3:161562      Median :   0.0045   Median :  0.8702  \n Mean   : 24.9097   4:711040      Mean   :   0.3468   Mean   :  7.4450  \n 3rd Qu.: 17.2016   5: 85180      3rd Qu.:   0.8747   3rd Qu.:  3.5313  \n Max.   :180.9997                 Max.   : 596.6656   Max.   :748.7875  \n                                                                        \n ma4_lateraldev      ma7_lateraldev     \n Min.   :-747.9141   Min.   :-747.3517  \n 1st Qu.:  -0.8684   1st Qu.:  -0.8775  \n Median :   0.0046   Median :   0.0051  \n Mean   :   0.3467   Mean   :   0.3467  \n 3rd Qu.:   0.8808   3rd Qu.:   0.8919  \n Max.   : 595.2119   Max.   : 594.3059  \n NA's   :4           NA's   :6          \n```\n\n\n:::\n:::\n\n\n\n------------------------------------------------------------------------\n\n<br/>\n\n**Note**: In conclusion of the EDA, I went from having limited understanding of the variables, to a robust and feature-engineered data frame while maintaining the original characteristics of the data. At this point, we want to split the tidy data frame, train and test the classification model.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_df1 <- df1[complete.cases(df1),]\nhead(clean_df1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 14\n  ARTCC Airline UniqueID    MeasureTaken xMeasureTaken xControlStartTm\n  <fct> <fct>   <chr>              <dbl> <time>        <time>         \n1 ZAU   AAL     AAL1016_141        61590 17:06:30      17:06          \n2 ZAU   AAL     AAL1016_141        61600 17:06:40      17:06          \n3 ZAU   AAL     AAL1016_141        61610 17:06:50      17:06          \n4 ZAU   AAL     AAL1016_141        61620 17:07:00      17:06          \n5 ZAU   AAL     AAL1016_141        61630 17:07:10      17:06          \n6 ZAU   AAL     AAL1016_141        61640 17:07:20      17:06          \n# ℹ 8 more variables: xControlEndTm <time>, LateralDeviation <dbl>,\n#   CorrectionAngle <dbl>, LateralStatus <fct>, WMA <dbl>, Abs_WMA <dbl>,\n#   ma4_lateraldev <dbl>, ma7_lateraldev <dbl>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n\n<br/><br/>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}